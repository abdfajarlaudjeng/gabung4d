<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gabung Angka Per AS dari Google Sheets</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 font-sans">
  <h1 class="text-2xl font-bold mb-4">Gabung Angka Per AS</h1>

  <!-- Filter dan pencarian -->
  <div class="mb-4 flex gap-4 flex-wrap">
    <select id="as-filter" class="p-2 border rounded">
      <option value="All">Semua AS</option>
      <option value="AS0">AS0</option>
      <option value="AS1">AS1</option>
      <option value="AS2">AS2</option>
      <option value="AS3">AS3</option>
      <option value="AS4">AS4</option>
      <option value="AS5">AS5</option>
      <option value="AS6">AS6</option>
      <option value="AS7">AS7</option>
      <option value="AS8">AS8</option>
    </select>

    <input type="text" id="search-input" placeholder="Cari angka..." class="p-2 border rounded flex-1">
    <input type="text" id="ekor-filter" placeholder="Filter Ekor (contoh: 5)" class="p-2 border rounded w-32">
  </div>

  <div id="as-container" class="space-y-4"></div>

  <script>
    const spreadsheetId = "1LBFj79uwQEB4uh8JT3_unOJxsYB3dgSzpslzPpgWiL8";
    const sheetName = "4D BERDASARKAN AS";
    const url = `https://opensheet.elk.sh/${spreadsheetId}/${sheetName}`;

    // Map AS ke baris di kolom B
    const asRows = {
      "AS0": [2,11], // baris 2 sampai 11
      "AS1": [2,11],
      "AS2": [2,11],
      "AS3": [2,11],
      "AS4": [2,11],
      "AS5": [2,11],
      "AS6": [2,11],
      "AS7": [2,11],
      "AS8": [2,11]
    };

    const container = document.getElementById("as-container");
    let allData = []; 

    fetch(url)
      .then(res => res.json())
      .then(data => {
        allData = data;
        renderAS("All", "", "");
      })
      .catch(err => {
        container.innerHTML = `<p class="text-red-500">Error mengambil data: ${err}</p>`;
      });

    function renderAS(filterAS, searchTerm, ekorFilter) {
      container.innerHTML = "";

      for (let asKey in asRows) {
        if (filterAS !== "All" && filterAS !== asKey) continue;

        const [startRow, endRow] = asRows[asKey];
        let gabungan = "";

        for (let i = startRow-2; i < endRow-1; i++) { // -2 karena index array 0
          const row = allData[i];
          if (!row || !row["B"]) continue;
          const valStr = row["B"].toString();
          const ekor = valStr[valStr.length-1];

          if (!ekorFilter || ekor === ekorFilter) {
            gabungan += valStr;
          }
        }

        if (searchTerm && !gabungan.includes(searchTerm)) continue;

        const div = document.createElement("div");
        div.className = "p-2 bg-white rounded shadow";
        div.innerHTML = `<strong>${asKey}:</strong> ${gabungan}`;
        container.appendChild(div);
      }
    }

    document.getElementById("as-filter").addEventListener("change", () => {
      renderAS(document.getElementById("as-filter").value,
               document.getElementById("search-input").value.trim(),
               document.getElementById("ekor-filter").value.trim());
    });

    document.getElementById("search-input").addEventListener("input", () => {
      renderAS(document.getElementById("as-filter").value,
               document.getElementById("search-input").value.trim(),
               document.getElementById("ekor-filter").value.trim());
    });

    document.getElementById("ekor-filter").addEventListener("input", () => {
      renderAS(document.getElementById("as-filter").value,
               document.getElementById("search-input").value.trim(),
               document.getElementById("ekor-filter").value.trim());
    });
  </script>
</body>
</html>
