<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gabung Angka Per AS dari Google Sheets</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 font-sans">
  <h1 class="text-2xl font-bold mb-4">Gabung Angka Per AS</h1>

  <!-- Filter dan pencarian -->
  <div class="mb-4 flex gap-4 flex-wrap">
    <select id="as-filter" class="p-2 border rounded">
      <option value="All">Semua AS</option>
      <option value="AS0">AS0</option>
      <option value="AS1">AS1</option>
      <option value="AS2">AS2</option>
      <option value="AS3">AS3</option>
      <option value="AS4">AS4</option>
      <option value="AS5">AS5</option>
      <option value="AS6">AS6</option>
      <option value="AS7">AS7</option>
      <option value="AS8">AS8</option>
      <option value="AS9">AS9</option>
    </select>

    <input type="text" id="search-input" placeholder="Cari angka..." class="p-2 border rounded flex-1">
    <input type="text" id="ekor-filter" placeholder="Filter Ekor (contoh: 5)" class="p-2 border rounded w-32">
  </div>

  <div id="as-container" class="space-y-4"></div>

  <script>
    const spreadsheetId = "1LBFj79uwQEB4uh8JT3_unOJxsYB3dgSzpslzPpgWiL8";
    const sheetName = "4D BERDASARKAN AS";
    const url = `https://opensheet.elk.sh/${spreadsheetId}/${sheetName}`;

    const asColumns = {
      "AS0": ["C","D","E","F"],
      "AS1": ["H","I","J","K"],
      "AS2": ["M","N","O","P"],
      "AS3": ["R","S","T","U"],
      "AS4": ["W","X","Y","Z"],
      "AS5": ["AB","AC","AD","AE"],
      "AS6": ["AG","AH","AI","AJ"],
      "AS7": ["AL","AM","AN","AO"],
      "AS8": ["AQ","AR","AS","AT"],
      "AS9": ["AV","AW","AX","AY"]
    };

    const container = document.getElementById("as-container");
    let allData = []; // simpan hasil gabungan untuk filter/search

    fetch(url)
      .then(response => response.json())
      .then(data => {
        allData = data; 
        renderAS("All", "", "");
      })
      .catch(err => {
        container.innerHTML = `<p class="text-red-500">Error mengambil data: ${err}</p>`;
      });

    function renderAS(filterAS, searchTerm, ekorFilter) {
      container.innerHTML = "";
      for (let asKey in asColumns) {
        if (filterAS !== "All" && filterAS !== asKey) continue;

        let cols = asColumns[asKey];
        let gabungan = "";

        allData.forEach(row => {
          cols.forEach(col => {
            if (row[col] !== undefined && row[col] !== "") {
              const valStr = row[col].toString();
              const ekor = valStr[valStr.length-1]; // digit terakhir
              if (!ekorFilter || ekor === ekorFilter) {
                gabungan += valStr;
              }
            }
          });
        });

        if (searchTerm && !gabungan.includes(searchTerm)) continue;

        const div = document.createElement("div");
        div.className = "p-2 bg-white rounded shadow";
        div.innerHTML = `<strong>${asKey}:</strong> ${gabungan}`;
        container.appendChild(div);
      }
    }

    // Event filter dropdown
    document.getElementById("as-filter").addEventListener("change", () => {
      const searchTerm = document.getElementById("search-input").value.trim();
      const ekorTerm = document.getElementById("ekor-filter").value.trim();
      renderAS(document.getElementById("as-filter").value, searchTerm, ekorTerm);
    });

    // Event input search
    document.getElementById("search-input").addEventListener("input", () => {
      const filterAS = document.getElementById("as-filter").value;
      const ekorTerm = document.getElementById("ekor-filter").value.trim();
      renderAS(filterAS, document.getElementById("search-input").value.trim(), ekorTerm);
    });

    // Event input ekor filter
    document.getElementById("ekor-filter").addEventListener("input", () => {
      const filterAS = document.getElementById("as-filter").value;
      const searchTerm = document.getElementById("search-input").value.trim();
      renderAS(filterAS, searchTerm, document.getElementById("ekor-filter").value.trim());
    });
  </script>
</body>
</html>
